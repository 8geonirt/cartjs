// Cart.js
// version: 0.1.0
// author: Gavin Ballard
// license: MIT
(function(){var a,b,c,d,e,f,g=function(a,b){return function(){return a.apply(b,arguments)}};b=function(){function a(){this.update=g(this.update,this)}return a.prototype.update=function(a){var b,c,e;for(c in a)e=a[c],"items"!==c&&(this[c]=e);return this.items=function(){var c,e,f,g;for(f=a.items,g=[],c=0,e=f.length;e>c;c++)b=f[c],g.push(new d(b));return g}()},a}(),d=function(){function a(a){this.propertyArray=g(this.propertyArray,this),this.update=g(this.update,this),this.update(a)}return a.prototype.update=function(a){var b,d;for(b in a)d=a[b],"properties"!==b&&(this[b]=d);return this.properties=c.Utils.extend({},a.properties)},a.prototype.propertyArray=function(){var a,b,c,d;c=this.properties,d=[];for(a in c)b=c[a],d.push({name:a,value:b});return d},a}(),c={settings:{dataAPI:!0,requestBodyClass:null,rivetsModels:{}},cart:new b},c.init=function(a,b){return null==b&&(b={}),c.configure(b),c.cart.update(a),c.settings.dataAPI&&c.Data.bind(),c.settings.requestBodyClass&&($(document).on("cart.requestStarted",function(){return $("body").addClass(c.settings.requestBodyClass)}),$(document).on("cart.requestComplete",function(){return $("body").removeClass(c.settings.requestBodyClass)})),c.Rivets.bindElements()},c.configure=function(a){return null==a&&(a={}),c.Utils.extend(c.settings,a)},c.Utils={wrapKeys:function(a,b,c){var d,e,f;null==b&&(b="properties"),f={};for(d in a)e=a[d],f[""+b+"["+d+"]"]=null!=c?c:e;return f},unwrapKeys:function(a,b,c){var d,e,f,g;null==b&&(b="properties"),e={};for(d in a)g=a[d],f=d.replace(""+b+"[","").replace("]",""),e[f]=null!=c?c:g;return e},extend:function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},clone:function(a){var b,c;if(null==a||"object"!=typeof a)return a;c=new a.constructor;for(b in a)c[b]=clone(a[b]);return c}},f=[],e=!1,c.Queue={add:function(a,b,d,g,h){return null==g&&(g="POST"),null==h&&(h="json"),f.push({url:a,data:b,success:d,type:g,dataType:h}),e?void 0:(jQuery(document).trigger("cart.requestStarted",[c.cart]),c.Queue.process())},process:function(){var a;return f.length?(e=!0,a=f.shift(),a.complete=c.Queue.process,jQuery.ajax(a)):(e=!1,void jQuery(document).trigger("cart.requestComplete",[c.cart]))}},c.Core={getCart:function(){return c.Queue.add("/cart.js",{},c.cart.update,"GET")},addItem:function(a,b,d){var e;return null==b&&(b=1),null==d&&(d={}),e=c.Utils.wrapKeys(d),e.id=a,e.quantity=b,c.Queue.add("/cart/add.js",e),c.Core.getCart()},updateItem:function(a,b,d){var e;return null==b&&(b=1),null==d&&(d={}),e=c.Utils.wrapKeys(d),e.line=a,e.quantity=b,c.Queue.add("/cart/change.js",e,c.cart.update)},removeItem:function(a){return c.Core.updateItem(a,0)},updateItemById:function(a,b,d){var e;return null==b&&(b=1),null==d&&(d={}),e=c.Utils.wrapKeys(d),e.id=a,e.quantity=b,c.Queue.add("/cart/change.js",e,c.cart.update)},removeItemById:function(a){var b;return b={id:a,quantity:0},c.Queue.add("/cart/change.js",b,c.cart.update)},clear:function(){return c.Queue.add("/cart/clear.js",{},c.cart.update)},getAttribute:function(a,b){return a in c.cart.attributes?c.cart.attributes[a]:b},setAttribute:function(a,b){var d;return d={},d[a]=b,c.Core.setAttributes(d)},getAttributes:function(){return c.cart.attributes},setAttributes:function(a){return null==a&&(a={}),c.Queue.add("/cart/update.js",c.Utils.wrapKeys(a,"attributes"),c.cart.update)},clearAttributes:function(){return c.Queue.add("/cart/update.js",c.Utils.wrapKeys(c.Core.getAttributes(),"attributes",""),c.cart.update)},getNote:function(){return c.cart.note},setNote:function(a){return c.Queue.add("/cart/update.js",{note:a},c.cart.update)}},a=jQuery(document),c.Data={bind:function(){return c.Data.bindOrUnbind("on")},unbind:function(){return c.Data.bindOrUnbind("off")},bindOrUnbind:function(b){return a[b]("click","[data-cart-add]",c.Data.add),a[b]("click","[data-cart-remove]",c.Data.remove),a[b]("click","[data-cart-remove-id]",c.Data.removeById),a[b]("click","[data-cart-update]",c.Data.update),a[b]("click","[data-cart-update-id]",c.Data.updateById),a[b]("change","[data-cart-toggle]",c.Data.toggle),a[b]("change","[data-cart-toggle-attribute]",c.Data.toggleAttribute),a[b]("submit","[data-cart-submit]",c.Data.submit)},add:function(a){var b;return a.preventDefault(),b=jQuery(a.target),c.Core.addItem(b.data("cartAdd"),b.data("cartQuantity"))},remove:function(a){var b;return a.preventDefault(),b=jQuery(a.target),c.Core.removeItem(b.data("cartRemove"))},removeById:function(a){var b;return a.preventDefault(),b=jQuery(a.target),c.Core.removeItemById(b.data("cartRemoveId"))},update:function(a){var b;return a.preventDefault(),b=jQuery(a.target),c.Core.updateItem(b.data("cartUpdate"),b.data("cartQuantity"))},updateById:function(a){var b;return a.preventDefault(),b=jQuery(a.target),c.Core.updateItemById(b.data("cartUpdateId"),b.data("cartQuantity"))},toggle:function(a){var b,d;return b=jQuery(a.target),d=b.data("cartToggle"),b.is(":checked")?c.Core.addItem(d):c.Core.removeAll(d)},toggleAttribute:function(a){var b,d;return b=jQuery(a.target),d=b.data("cartToggleAttribute"),c.Core.setAttribute(d,b.is(":checked")?"Yes":"")},submit:function(a){var b,d,e,f;return a.preventDefault(),b=jQuery(a.target).serializeArray(),d=void 0,f=void 0,e={},jQuery.each(b,function(a,b){return"id"===b.name?d=b.value:"quantity"===b.name?f=b.value:e[b.name]=b.value}),c.Core.addItem(d,f,c.Utils.unwrapKeys(e))}},"rivets"in window?(c.Rivets={views:[],bindElements:function(){var a;return c.Rivets.unbindElements(),a=c.Utils.extend({cart:c.cart},c.settings.rivetsModels),jQuery("[data-cart-view]").each(function(){return c.Rivets.views.push(rivets.bind(this,a))})},unbindElements:function(){var a,b,d,e;for(e=c.Rivets.views,b=0,d=e.length;d>b;b++)a=e[b],a.unbind();return c.Rivets.views=[]}},rivets.formatters.eq=function(a,b){return a===b},rivets.formatters.lt=function(a,b){return b>a},rivets.formatters.gt=function(a,b){return a>b},rivets.formatters.not=function(a){return!a},rivets.formatters.empty=function(a){return!a.length},rivets.formatters.plus=function(a,b){return parseInt(a)+parseInt(b)},rivets.formatters.minus=function(a,b){return parseInt(a)-parseInt(b)},"Shopify"in window&&("formatMoney"in window.Shopify&&(rivets.formatters.money=function(a){return Shopify.formatMoney(a,c.settings.money_format)},rivets.formatters.money_with_currency=function(a){return Shopify.formatMoney(a,c.settings.money_with_currency_format)}),"Image"in window.Shopify&&"getSizedImageUrl"in window.Shopify.Image&&(rivets.formatters.productImageSize=function(a,b){return Shopify.Image.getSizedImageUrl(a,b)}))):c.Rivets={bindElements:function(){},unbindElements:function(){}},c.factory=function(a){return a.init=c.init,a.configure=c.configure,a.cart=c.cart,a.settings=c.settings,a.addItem=c.Core.addItem,a.updateItem=c.Core.updateItem,a.updateItemById=c.Core.updateItemById,a.removeItem=c.Core.removeItem,a.removeAll=c.Core.removeAll,a.clear=c.Core.clear,a.getAttribute=c.Core.getAttribute,a.setAttribute=c.Core.setAttribute,a.getAttributes=c.Core.getAttributes,a.setAttributes=c.Core.setAttributes,a.clearAttributes=c.Core.clearAttributes,a.getNote=c.Core.getNote,a.setNote=c.Core.setNote},"object"==typeof exports?c.factory(exports):"function"==typeof define&&define.amd?define(["exports"],function(a){return c.factory(this.CartJS=a),a}):c.factory(this.CartJS={})}).call(this);